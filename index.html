<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EPICAL PD Assistant Local Test</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="ops-bar" id="ops-bar">
      <div class="ops-meta">
        <span id="ops-officer">Officer: Unassigned</span>
        <span id="ops-officer-patrol">Officer Patrol: Unset</span>
        <span id="ops-suspects">Suspects: unknown</span>
      </div>
      <div class="ops-grid">
        <div class="ops-cell">
          <span class="ops-label">Top Point</span>
          <span class="ops-value" id="ops-top-point">Awaiting scene input</span>
        </div>
        <div class="ops-cell">
          <span class="ops-label">Urgent Action</span>
          <span class="ops-value" id="ops-urgent-action">Awaiting scene input</span>
        </div>
        <div class="ops-cell">
          <span class="ops-label">Key Section</span>
          <span class="ops-value" id="ops-key-section">Awaiting scene input</span>
        </div>
        <div class="ops-cell">
          <span class="ops-label">Next Step</span>
          <span class="ops-value" id="ops-next-step">Awaiting scene input</span>
        </div>
      </div>
      <div class="ops-stamps">
        <div class="ops-stamp-card">
          <span class="ops-stamp-label">Time of Stop</span>
          <div class="ops-stamp-row">
            <button type="button" class="secondary-btn ops-stamp-btn" id="stamp-stop-btn">Stamp UK Time</button>
            <span class="ops-stamp-value" id="stamp-stop-value">Not stamped</span>
          </div>
        </div>
        <div class="ops-stamp-card">
          <span class="ops-stamp-label">Time of Search</span>
          <div class="ops-stamp-row">
            <button type="button" class="secondary-btn ops-stamp-btn" id="stamp-search-btn">Stamp UK Time</button>
            <span class="ops-stamp-value" id="stamp-search-value">Not stamped</span>
          </div>
        </div>
        <div class="ops-stamp-card">
          <span class="ops-stamp-label">Time of Arrest</span>
          <div class="ops-stamp-row">
            <button type="button" class="secondary-btn ops-stamp-btn" id="stamp-arrest-btn">Stamp UK Time</button>
            <span class="ops-stamp-value" id="stamp-arrest-value">Not stamped</span>
          </div>
        </div>
      </div>
      <div class="ops-disclaimer">
        Disclaimer: This is not yet approved for police duty. Test or reference purposes only.
      </div>
      <nav class="ops-tabs" aria-label="Assistant Tabs">
        <a class="ops-tab is-active" aria-current="page" href="./index.html">Assistant</a>
        <a class="ops-tab" href="./investigations.html">Investigation</a>
      </nav>
    </header>

    <main class="layout">
      <section class="panel">
        <header class="panel-head">
          <div class="panel-head-row">
            <div>
              <h1>EPICAL PD Assistant</h1>
              <p class="sub">Scene decision support and city-computer handover</p>
            </div>
            <button type="button" id="theme-toggle" class="secondary-btn">Dark Mode</button>
          </div>
          <p class="muted">
            City policy profile: non-motorway limit 50 mph, motorway 100 mph, cannabis <=15g usually confiscation, cash up to GBP
            10,000 generally acceptable.
          </p>
        </header>

        <form id="scene-form">
          <fieldset>
            <legend>Officer Profile (Saved Locally)</legend>
            <div class="grid">
              <label>
                Officer Name
                <input type="text" name="officerName" placeholder="Officer name" />
              </label>
              <label>
                Rank
                <select name="officerRank">
                  <option value="spc">Student PC</option>
                  <option value="pc">Police Constable</option>
                  <option value="sgt">Sergeant</option>
                  <option value="insp">Inspector</option>
                  <option value="ci">Chief Inspector</option>
                </select>
              </label>
            </div>

            <div class="grid">
              <label>
                Officer Number
                <input type="text" name="officerNumber" placeholder="110" />
              </label>
              <label>
                Badge / Callsign (Auto)
                <input type="text" id="officer-callsign" readonly value="SPC" />
              </label>
            </div>

            <div class="grid">
              <label>
                Current Patrol Mode (Officer)
                <select name="officerPatrolMode">
                  <option value="response_vehicle">Response Vehicle</option>
                  <option value="foot_patrol">Foot Patrol</option>
                  <option value="traffic_unit">Traffic Unit</option>
                  <option value="motor_unit">Motor Unit</option>
                  <option value="custody">Custody</option>
                  <option value="plain_clothes">Plain Clothes</option>
                </select>
              </label>
            </div>
          </fieldset>

          <fieldset>
            <legend>Primary Scene</legend>
            <label>
              Location / Street
              <input type="text" name="location" placeholder="Mirror Park, Elgin Ave" required />
            </label>

            <div class="grid">
              <label>
                Suspect Stopped On
                <select name="mode">
                  <option value="foot">On foot</option>
                  <option value="vehicle">In vehicle (car/van)</option>
                  <option value="motorcycle">On motorcycle</option>
                  <option value="bicycle">On bicycle</option>
                </select>
              </label>

              <label>
                Incident Type
                <select name="incidentType">
                  <option value="suspicious_person">Suspicious person</option>
                  <option value="traffic_stop">Traffic stop</option>
                  <option value="public_disorder">Public disorder</option>
                  <option value="assault_report">Assault report</option>
                  <option value="weapon_sighting">Weapon sighting</option>
                  <option value="pursuit">Vehicle pursuit</option>
                  <option value="hostage">Hostage situation</option>
                </select>
              </label>
            </div>

            <div class="grid">
              <label>
                Subject Behavior
                <select name="behavior">
                  <option value="compliant">Compliant</option>
                  <option value="evasive">Evasive</option>
                  <option value="aggressive">Aggressive</option>
                  <option value="fleeing">Fleeing</option>
                </select>
              </label>

              <label>
                Public Density
                <select name="publicDensity">
                  <option value="low">Low</option>
                  <option value="medium">Medium</option>
                  <option value="high">High</option>
                </select>
              </label>
            </div>

            <div class="grid">
              <label>
                PD On Duty
                <input type="number" name="pdOnDuty" min="0" value="4" />
              </label>
              <label>
                Number of Subjects
                <input type="number" name="groupSize" min="1" value="1" />
              </label>
            </div>
          </fieldset>

          <fieldset>
            <legend>Grounds / Context</legend>
            <label><input type="checkbox" name="grounds" value="smell_drugs" /> Smell of drugs</label>
            <label><input type="checkbox" name="grounds" value="drug_paraphernalia" /> Drug paraphernalia seen</label>
            <label><input type="checkbox" name="grounds" value="weapon_bulge" /> Weapon bulge / object print</label>
            <label><input type="checkbox" name="grounds" value="stolen_vehicle_marker" /> Stolen vehicle marker</label>
            <label><input type="checkbox" name="grounds" value="witness_statement" /> Credible witness statement</label>
            <label><input type="checkbox" name="grounds" value="intel_link" /> Active intelligence link</label>
            <label><input type="checkbox" name="grounds" value="admission_made" /> Subject admission made</label>
          </fieldset>

          <fieldset>
            <legend>Identity / Compliance Factors</legend>
            <div class="suspect-header">
              <span class="suspect-title">Suspect Name(s)</span>
              <button type="button" id="add-suspect" class="secondary-btn small-btn">+ Add</button>
            </div>
            <div id="suspect-list" class="suspect-list">
              <div class="suspect-row">
                <input class="suspect-name-input" type="text" name="suspectNames" placeholder="Suspect name or identifier" />
              </div>
            </div>
            <label><input type="checkbox" name="refusesProvideId" /> Not willing to provide ID / name / address</label>
            <label><input type="checkbox" name="suspectedFalseIdentity" /> Suspected false details provided</label>
            <label><input type="checkbox" name="noFixedAddress" /> No fixed or verifiable address</label>
            <label><input type="checkbox" name="obstructiveConduct" /> Obstructive or persistent non-compliance</label>
            <label><input type="checkbox" name="refusesVehicleDocs" /> Refuses vehicle docs/details request</label>
            <label><input type="checkbox" name="faceCoveringPresent" /> Face covering present</label>
            <label><input type="checkbox" name="refusesRemoveFaceCovering" /> Refuses to remove face covering when requested</label>
            <p class="muted">
              UK context: there is no general duty to provide ID on foot. ID/docs duties are stronger in lawful vehicle-stop context
              and offence-linked necessity decisions. Face-covering removal usually needs specific lawful power (for example s60AA
              authorised context).
            </p>
          </fieldset>

          <fieldset>
            <legend>Live Risk Flags</legend>
            <label><input type="checkbox" name="weaponSeen" /> Weapon seen</label>
            <label><input type="checkbox" name="activeShots" /> Active shots fired</label>
            <label><input type="checkbox" name="injuryPresent" /> Injury present</label>
            <label><input type="checkbox" name="knownViolenceMarker" /> Known violence marker</label>
            <label><input type="checkbox" name="subjectIntoxicated" /> Subject appears intoxicated</label>
            <label><input type="checkbox" name="s60Authorized" /> s60 authorized area (RP event)</label>
            <label><input type="checkbox" name="childVulnerableRisk" /> Child or vulnerable person at risk</label>
            <label><input type="checkbox" name="propertyDamageRisk" /> Risk of loss or damage to property</label>
            <label><input type="checkbox" name="publicDecencyRisk" /> Risk of offence against public decency</label>
            <label><input type="checkbox" name="highwayObstructionRisk" /> Risk of unlawful highway obstruction</label>
          </fieldset>

          <fieldset class="dynamic-fieldset" data-show="vehicleContext">
            <legend>Vehicle Dynamics</legend>
            <div class="grid">
              <label>
                Current / Last Known Speed (mph)
                <input type="number" name="speedMph" min="0" max="220" value="0" />
              </label>

              <label>
                Road Type
                <select name="roadType">
                  <option value="urban">Urban</option>
                  <option value="motorway">Motorway</option>
                  <option value="rural">Rural</option>
                </select>
              </label>
            </div>

            <div class="grid">
              <label>
                Traffic Density
                <select name="trafficDensity">
                  <option value="low">Low</option>
                  <option value="medium">Medium</option>
                  <option value="high">High</option>
                </select>
              </label>

              <label>
                Vehicle Condition
                <select name="vehicleCondition">
                  <option value="normal">Normal</option>
                  <option value="smoking">Smoking</option>
                  <option value="blown_tires">Blown tires</option>
                  <option value="critical">Critical damage</option>
                </select>
              </label>
            </div>

            <label><input type="checkbox" name="vehicleAntisocial" /> Vehicle anti-social use (s59 route)</label>
            <label><input type="checkbox" name="priorS59Warning" /> Existing active s59 warning</label>
            <label><input type="checkbox" name="vehiclePulledOver" /> Vehicle has been lawfully pulled over / stop completed</label>
            <p class="muted">Traffic lights are usually treated as give-way: full stop if lane is blocked.</p>
          </fieldset>

          <fieldset class="dynamic-fieldset" data-show="pursuitContext">
            <legend>Pursuit Metrics</legend>
            <div class="grid">
              <label>
                Pursuit Duration (minutes)
                <input type="number" name="pursuitDurationMin" min="0" max="120" value="0" />
              </label>
              <label>
                Number of Failed Stop Signals
                <input type="number" name="failedStopSignals" min="0" max="20" value="0" />
              </label>
            </div>
          </fieldset>

          <fieldset class="dynamic-fieldset" data-show="drugContext">
            <legend>Drug Intelligence</legend>
            <div class="grid">
              <label>
                Suspected Drug Type
                <select name="drugType">
                  <option value="unknown">Unknown</option>
                  <option value="cannabis">Cannabis</option>
                  <option value="class_b">Class B</option>
                  <option value="class_a">Class A</option>
                </select>
              </label>
              <label>
                Estimated Quantity (grams)
                <input type="number" name="drugQuantityGrams" min="0" step="0.1" value="0" />
              </label>
            </div>

            <label>
              Packaging Indicator
              <select name="drugPackaging">
                <option value="none">None / unknown</option>
                <option value="personal">Personal amount</option>
                <option value="split_bags">Multiple split bags</option>
                <option value="dealer_pack">Dealer-style wraps</option>
                <option value="bulk">Bulk package</option>
              </select>
            </label>
          </fieldset>

          <fieldset>
            <legend>Property / Cash Context</legend>
            <label>
              Seized / Declared Cash (GBP)
              <input type="number" name="seizedCashGbp" min="0" step="1" value="0" />
            </label>
            <p class="muted">City guidance: cash at or below GBP 10,000 is usually acceptable within reason.</p>
          </fieldset>

          <fieldset>
            <legend>Server Rule Context</legend>
            <label><input type="checkbox" name="amberZone" /> In amber zone</label>
            <label><input type="checkbox" name="sceneStartedInAmber" /> Scene started here (amber zone)</label>
            <label><input type="checkbox" name="medicalAttemptDuringActive" /> Player trying medical during active scene</label>
            <label><input type="checkbox" name="taserHitTwo" /> Subject hit by taser twice</label>
            <label><input type="checkbox" name="ehsKidnapAttempt" /> EHS kidnapping attempt</label>
          </fieldset>

          <label>
            Notes
            <textarea name="notes" rows="3" placeholder="Observed behavior / statements..."></textarea>
          </label>

          <div class="context-strip" id="context-strip"></div>
          <button type="submit">Generate / Refresh Action Card</button>
        </form>
      </section>

      <section class="panel result" id="result">
        <h2>Action Card</h2>
        <p class="sub">Live recommendations appear as you complete the form.</p>
      </section>
    </main>

    <script src="./engine.js"></script>
    <script src="./app.js"></script>
  </body>
</html>
